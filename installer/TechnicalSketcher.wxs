<?xml version="1.0" encoding="utf-8"?>
<!-- The name of the product -->
<?define Name = "TechnicalSketcher" ?>
<!-- The Description of the product -->
<?define Description = "A drawing utility for vector graphics" ?>
<!-- The manufacturer, for setup package publisher and folder info -->
<?define Manufacturer = "Florian Zachs" ?>
<!-- The version number of this setup package-->
<?define Version = "0.0.0.0" ?>
<!-- UpgradeCode must be unique and not changed once the first version of the program is installed. -->
<?define UpgradeCode = "{619dbe21-bdf1-43c7-b39c-eb657715154e}" ?>
<!-- The name of the Cabinet -->
<?define CabName = "TechnicalSketcher.cab" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="60143f8d-5524-4b34-a894-ea57cc15425d" Name="$(var.Name)" Manufacturer="$(var.Manufacturer)" UpgradeCode="$(var.UpgradeCode)" Version="$(var.Version)" Language="1033">
        <!--Setup or Installer with properties-->
        <Package InstallerVersion="200" Compressed="yes" InstallScope="perUser" InstallPrivileges="limited" Description="$(var.Name)" Manufacturer="$(var.Manufacturer)" />
        <!--Application logo-->
        <Icon Id="TechnicalSketcher.ico" SourceFile="../resource/TechnicalSketcher.ico" />
        <!--Application logo for Control Panel-->
        <Property Id="ARPPRODUCTICON" Value="TechnicalSketcher.ico" />
        <!--Embed Cabinet into single msi file-->
        <Media Id="1" Cabinet="$(var.CabName)" EmbedCab="yes" />
        <!-- Allow upgrades and prevent downgrades -->
        <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
        <!--Main Feature for this Setup which can be found in Fragment Tag with ComponentGroupRef Id-->
        <Feature Id="ProductFeature" Title="$(var.Name)" Level="1">
            <!--Main application executable component-->
            <ComponentGroupRef Id="ProductComponents" />
            <!--Remove root folder-->
            <ComponentRef Id="RootFolder" />
            <ComponentRef Id="TechnicalSketcher.exe" />
        </Feature>
        <UI />
    </Product>
    <!--Fragment with details of installation directory-->
    <Fragment>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="LocalAppDataFolder">
                <Directory Id="ROOTFOLDER" Name="$(var.Name)">
                    <Directory Id="INSTALLFOLDER" Name="latest" />
                    <Component Id="RootFolder" Guid="{a287abac-0536-4205-8c51-d84ccf32afcb}">
                        <CreateFolder />
                        <RemoveFile Id="ROOTFOLDER" Name="*.*" On="uninstall" />
                        <RemoveFolder Id="ROOTFOLDERF" Directory="ROOTFOLDER" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\$(var.Name)" Name="root_dir" Type="integer" Value="1" KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>
        </Directory>
        <!--ComponentGroup refering to install component in INSTALLFOLDER Directory-->
        <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
            <!--Main Component with application executable path-->
            <Component Id="TechnicalSketcher.exe" Guid="3f5cc018-4389-4001-b07f-081b3af9d2c2">
				<!--<File Id="TechnicalSketcher.exe" Name="TechnicalSketcher.exe" Source="../bin/deploy/TechnicalSketcher.exe" />-->
                <File Id="TechnicalSketcher.exe" Name="TechnicalSketcher.exe" Source="../../AllegroNativeTest/AllegroNativeTest/x64/Debug/AllegroNativeTest.exe" />
                <!-- Remove all files from the INSTALLFOLDER on uninstall -->
                <RemoveFile Id="ALLFILES" Name="*.*" On="both" />
                <RemoveFolder Id="INSTALLFOLDER" On="uninstall" />
                <RegistryValue Root="HKCU" Key="Software\$(var.Name)" Name="exe_installed" Type="integer" Value="1" KeyPath="yes" />
            </Component>
        </ComponentGroup>
        <!--Start Application after install-->
        <CustomAction Id="EXECUTE_AFTER_FINALIZE" Execute="immediate" Impersonate="yes" Return="asyncNoWait" FileKey="TechnicalSketcher.exe" ExeCommand="" />
        <InstallExecuteSequence>
            <Custom Action="EXECUTE_AFTER_FINALIZE" After="InstallFinalize">NOT Installed</Custom>
        </InstallExecuteSequence>
    </Fragment>
</Wix>